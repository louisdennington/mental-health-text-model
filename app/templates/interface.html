<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mental Health Clustering Tool</title>
  <style>
    body {
      font-family: "IBM Plex Sans", sans-serif;
      background-color: white;
      color: black;
      padding: 2rem;
      line-height: 1.6;
    }

    h1 {
      font-size: 1.5rem;
      margin-bottom: 1rem;
    }

    textarea {
      width: 100%;
      min-height: 120px;
      font-size: 1rem;
      padding: 0.75rem;
      border: 1px solid black;
      font-family: inherit;
    }

    button {
      background: white;
      color: black;
      border: 2px solid black;
      padding: 0.5rem 1rem;
      margin: 0.5rem 0.5rem 0 0;
      cursor: pointer;
      font-family: inherit;
    }

    #output {
      white-space: pre-wrap;
      margin-top: 1rem;
      font-size: 1.1rem;
    }

    .hidden {
      display: none;
    }

    .collapsible {
      margin-top: 2rem;
      cursor: pointer;
      font-weight: bold;
    }

    .content {
      display: none;
      margin-top: 0.5rem;
      border-left: 2px solid black;
      padding-left: 1rem;
      font-size: 0.9rem;
    }

    .rating-container {
      margin-top: 2rem;
    }

    input[type=range] {
      width: 100%;
      -webkit-appearance: none;
      height: 6px;
      background: black;
      border-radius: 0;
      outline: none;
    }

    input[type=range]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 16px;
      height: 16px;
      background: white;
      border: 2px solid black;
      cursor: pointer;
    }

    .range-labels {
      display: flex;
      justify-content: space-between;
      font-size: 0.8rem;
      margin-top: 0.25rem;
    }

    textarea#feedbackBox {
      margin-top: 0.5rem;
      width: 100%;
      min-height: 60px;
      font-size: 1rem;
      padding: 0.5rem;
      border: 1px solid black;
      font-family: inherit;
    }

    @media (min-width: 800px) {
      .technical-box {
        float: right;
        width: 30%;
        margin-left: 2rem;
      }
    }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans&display=swap" rel="stylesheet">
</head>
<body>
  <h1>&gt; Welcome to the clustering tool</h1>
  <p>This tool uses a machine learning model to classify mental health writing into psychological themes. It doesn’t give a diagnosis and should never replace professional help. It simply offers a reflective response based on common language patterns seen in online posts. Minimum 50 words required.</p>

  <textarea id="userInput" placeholder="Type your thoughts here..."></textarea>
  <br />
  <button onclick="handleSubmit()">Submit</button>
  <button class="hidden" id="editBtn" onclick="handleEdit()">Edit what I wrote</button>
  <button class="hidden" id="restartBtn" onclick="handleRestart()">Start again</button>

  <div id="output"></div>

  <div id="ratingSection" class="rating-container hidden">
    <p style="margin-top: 2rem; margin-bottom: 0.5rem;">Rate the accuracy of this response:</p>
    <input type="range" min="0" max="10" value="5" id="ratingSlider">
    <div class="range-labels">
      <span>Not accurate at all</span>
      <span>Fits me perfectly</span>
    </div>
    <textarea id="feedbackBox" placeholder="Optional: Leave additional feedback here..."></textarea>
  </div>

  <div class="collapsible" onclick="toggleTechnical()">
    ▶ Technical Specifications
  </div>
  <div class="content" id="techContent">
    <p>This tool uses the Sentence-BERT embedding model and a k-Nearest Neighbors search (FAISS) to assign your input to one of 21 pre-defined thematic clusters. No personal data is stored. The clusters were developed from analysis of over 2,000 anonymized Reddit posts.</p>
  </div>

  <script>
    async function handleSubmit() {
      const input = document.getElementById("userInput").value.trim();
      if (input.split(" ").length < 50) {
        alert("Please enter at least 50 words.");
        return;
      }
  
      // Clear previous output
      document.getElementById("output").innerText = "⏳ Processing your text...";
  
      try {
        const response = await fetch("https://mental-health-clustering-from-text-input.onrender.com", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ text: input })
        });
  
        const data = await response.json();
  
        if (data.error) {
          document.getElementById("output").innerText = data.error;
          return;
        }
  
        const message = `📌 Your post belongs to Cluster ${data.cluster}\n\n${data.response}\n\nCertainty Score: ${data.certainty * 100}%`;
        typeResponse(message);
  
        document.getElementById("editBtn").classList.remove("hidden");
        document.getElementById("restartBtn").classList.remove("hidden");
        document.getElementById("ratingSection").classList.remove("hidden");
      } catch (error) {
        document.getElementById("output").innerText = "❌ Error contacting the server. Please try again later.";
        console.error(error);
      }
    }
  
    function typeResponse(text) {
      let i = 0;
      const speed = 20;
      const outputDiv = document.getElementById("output");
      outputDiv.innerText = "";
      function type() {
        if (i < text.length) {
          outputDiv.innerText += text.charAt(i);
          i++;
          setTimeout(type, speed);
        }
      }
      type();
    }
  
    function handleEdit() {
      document.getElementById("userInput").focus();
    }
  
    function handleRestart() {
      document.getElementById("userInput").value = "";
      document.getElementById("output").innerText = "";
      document.getElementById("editBtn").classList.add("hidden");
      document.getElementById("restartBtn").classList.add("hidden");
      document.getElementById("ratingSection").classList.add("hidden");
      document.getElementById("feedbackBox").value = "";
    }
  
    function toggleTechnical() {
      const content = document.getElementById("techContent");
      content.style.display = content.style.display === "block" ? "none" : "block";
    }
  </script>
  
</body>
</html>
